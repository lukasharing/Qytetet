<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE vxml PUBLIC "-//W3C//DTD VOICEXML 2.0//EN" "http://www.w3.org/TR/voicexml20/vxml.dtd">
<vxml version="2.0" xml:lang="es-ES">
<meta name="author" content="Lukas Haring"/>
<meta name="maintainer" content="lukasharing@correo.ugr.es"/>

    <script><![CDATA[

        function generate(next, seed){
            var options = [
                {
                    text: "¿Quién estuvo enterrada en la Alhambra?",
                    correct: "Isabel la Católica"
                },
                {
                    text: "En qué puesto se quedó el año pasado la Alhambra de los monumentos más visitados",
                    correct: "Cuarto"
                },
                {
                    text: "Diga si o no, si es verdadera la siguiente afirmación: La Alhambra mantuvo una carta escondida una carta de amor durante 92 años entre sus paredes",
                    correct: "Si"
                },
                {
                    text: "Diga si o no, si es verdadera la siguiente afirmación: La Alhmabra fué invadidad por los chinos",
                    correct: "No"
                },
                {
                    text: "Diga Norte Sur Este o Oeste donde se encuentra la siguiente entrada, Arrabal",
                    correct: "Norte"
                },
                {
                    text: "Diga Norte Sur Este o Oeste donde se encuentra la siguiente entrada, Plaza Nueva",
                    correct: "Sur"
                },
                {
                    text: "En qué puesto se quedó en 2016 la Alhambra de los monumentos más visitados",
                    correct: "Segundo"
                }
            ]
            return options[(seed + next) % options.length];
        }

    ]]></script>

    <!-- Phrases to say when need help-->
    <link event="help">
        <grammar src="./grammatics/help.jsgf" />
    </link>

    <!-- Salir en cualquier momento -->
    <link event="exit">
        <grammar src="./grammatics/exit.jsgf" />
    </link>

    <catch event="exit">
        <goto next="./welcome.vxml"/>
    </catch>

    <!-- Menu -->
    <form id="visitorES">
        <!-- Form Variables -->
        <var name="seed" expr="parseInt(Math.random() * 7)" />
        <var name="correct" expr="0" />
        <var name="question" expr="1" />
        <var name="next" expr="generate(question, seed)" />

        <!-- Initial -->
        <block>
            <prompt bargein="false"><break/>Si acierta las cuatro preguntas obtendrá una recompensa en su próxima visita.</prompt>
        </block>

        <!-- Iterative Field -->
        <field name="questionRan" modal="false">
            
            <!-- Ask the question -->
            <prompt bargein="false">Pregunta numero <value expr="question" /> <break/></prompt>
            <prompt bargein="false" timeout="5s"><value expr="generate(question, seed).text" /></prompt>
            
            <grammar>Isabel la Católica | Cuarto | Si | No | Norte | Segundo | Sur</grammar>

            <!-- Check the answer -->
            <filled>

                <var name="correctq" expr="generate(question, seed).correct" />
                <var name="question" expr="question + 1" />
                <var name="next" expr="generate(question, seed)" />
                
                <if cond="correctq == questionRan">
                    <prompt bargein="false">Correcto!</prompt>
                    <var name="correct" expr="correct + 1" />
                <else />
                    <prompt bargein="false">Incorrecto!</prompt>
                </if>

                <if cond="question &lt; 4">
                    <throw event="nomatch" />
                </if>
            </filled>
            
            <noinput>
                <throw event="nomatch" />
            </noinput>

            <!-- Catch for next question -->
            <catch event="noinput nomatch">
                <clear namelist="questionRan" />
                <goto nextitem="questionRan"/>
            </catch>
            
        </field>
        <!-- Result -->
        <block>
            <prompt bargein="false">Usted ha acetado <value expr="correct" /> de las preguntas realizadas</prompt>
            <if cond="correct == 4">
                <prompt bargein="false">¡Felicidades ha obtenido un 20 porciento de descuento con el código WIN20!</prompt>
            </if>
            <goto next="./welcome.vxml"/>
        </block>

    </form>
</vxml>